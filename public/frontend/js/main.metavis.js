/*----------------
    TOOLTIPS
----------------*/
app.plugins.createTooltip({
    container: '.text-tooltip-tfr',
    offset: 4,
    direction: 'right',
    animation: {
        type: 'translate-in-fade'
    }
});

app.plugins.createTooltip({
    container: '.text-tooltip-tft',
    offset: 4,
    direction: 'top',
    animation: {
        type: 'translate-out-fade'
    }
});

app.plugins.createTooltip({
    container: '.text-tooltip-tft-medium',
    offset: 8,
    direction: 'top',
    animation: {
        type: 'translate-out-fade'
    }
});

/*----------------
    HEXAGON
----------------*/

app.plugins.createHexagon({
    container: '.hexagon-148-164',
    width: 148,
    height: 164,
    roundedCorners: true,
    fill: true,
    lineColor: '#1d2333'
});

app.plugins.createHexagon({
    container: '.hexagon-progress-124-136',
    width: 124,
    height: 136,
    lineWidth: 8,
    roundedCorners: true,
    gradient: {
        colors: ['#d9ff65', '#40d04f']
    },
    scale: {
        start: 0,
        end: 1,
        stop: .74
    }
});

app.plugins.createHexagon({
    container: '.hexagon-border-124-136',
    width: 124,
    height: 136,
    lineWidth: 8,
    roundedCorners: true,
    lineColor: '#293249'
});

app.plugins.createHexagon({
    container: '.hexagon-image-100-110',
    width: 100,
    height: 110,
    roundedCorners: true,
    clip: true
});

app.plugins.createHexagon({
    container: '.hexagon-120-132',
    width: 120,
    height: 132,
    roundedCorners: true,
    fill: true,
    lineColor: '#1d2333'
});

app.plugins.createHexagon({
    container: '.hexagon-progress-100-110',
    width: 100,
    height: 110,
    lineWidth: 6,
    roundedCorners: true,
    gradient: {
        colors: ['#d9ff65', '#40d04f']
    },
    scale: {
        start: 0,
        end: 1,
        stop: .8
    }
});

app.plugins.createHexagon({
    container: '.hexagon-border-100-110',
    width: 100,
    height: 110,
    lineWidth: 6,
    roundedCorners: true,
    lineColor: '#293249'
});

app.plugins.createHexagon({
    container: '.hexagon-image-82-90',
    width: 82,
    height: 90,
    roundedCorners: true,
    roundedCornerRadius: 3,
    clip: true
});

app.plugins.createHexagon({
    container: '.hexagon-100-110',
    width: 100,
    height: 110,
    roundedCorners: true,
    fill: true,
    lineColor: '#1d2333'
});

app.plugins.createHexagon({
    container: '.hexagon-progress-84-92',
    width: 84,
    height: 92,
    lineWidth: 5,
    roundedCorners: true,
    roundedCornerRadius: 3,
    gradient: {
        colors: ['#d9ff65', '#40d04f']
    },
    scale: {
        start: 0,
        end: 1,
        stop: .8
    }
});

app.plugins.createHexagon({
    container: '.hexagon-border-84-92',
    width: 84,
    height: 92,
    lineWidth: 5,
    roundedCorners: true,
    roundedCornerRadius: 3,
    lineColor: '#293249'
});

app.plugins.createHexagon({
    container: '.hexagon-image-68-74',
    width: 68,
    height: 74,
    roundedCorners: true,
    roundedCornerRadius: 3,
    clip: true
});

app.plugins.createHexagon({
    container: '.hexagon-50-56',
    width: 50,
    height: 56,
    roundedCorners: true,
    roundedCornerRadius: 2,
    fill: true,
    lineColor: '#1d2333'
});

app.plugins.createHexagon({
    container: '.hexagon-progress-40-44',
    width: 40,
    height: 44,
    lineWidth: 3,
    roundedCorners: true,
    roundedCornerRadius: 1,
    gradient: {
        colors: ['#d9ff65', '#40d04f']
    },
    scale: {
        start: 0,
        end: 1,
        stop: .8
    }
});

app.plugins.createHexagon({
    container: '.hexagon-border-40-44',
    width: 40,
    height: 44,
    lineWidth: 3,
    roundedCorners: true,
    roundedCornerRadius: 1,
    lineColor: '#293249'
});

app.plugins.createHexagon({
    container: '.hexagon-image-30-32',
    width: 30,
    height: 32,
    roundedCorners: true,
    roundedCornerRadius: 1,
    clip: true
});

app.plugins.createHexagon({
    container: '.hexagon-40-44',
    width: 40,
    height: 44,
    roundedCorners: true,
    roundedCornerRadius: 1,
    fill: true,
    lineColor: '#1d2333'
});

app.plugins.createHexagon({
    container: '.hexagon-dark-32-34',
    width: 32,
    height: 34,
    roundedCorners: true,
    roundedCornerRadius: 1,
    lineColor: '#7750f8',
    fill: true
});

app.plugins.createHexagon({
    container: '.hexagon-32-36',
    width: 32,
    height: 36,
    roundedCorners: true,
    roundedCornerRadius: 1,
    lineColor: '#1d2333',
    fill: true
});

app.plugins.createHexagon({
    container: '.hexagon-dark-26-28',
    width: 26,
    height: 28,
    roundedCorners: true,
    roundedCornerRadius: 1,
    lineColor: '#7750f8',
    fill: true
});

app.plugins.createHexagon({
    container: '.hexagon-28-32',
    width: 28,
    height: 32,
    roundedCorners: true,
    roundedCornerRadius: 1,
    lineColor: '#1d2333',
    fill: true
});

app.plugins.createHexagon({
    container: '.hexagon-dark-22-24',
    width: 22,
    height: 24,
    roundedCorners: true,
    roundedCornerRadius: 1,
    lineColor: '#7750f8',
    fill: true
});

app.plugins.createHexagon({
    container: '.hexagon-22-24',
    width: 22,
    height: 24,
    roundedCorners: true,
    roundedCornerRadius: 1,
    lineColor: '#1d2333',
    fill: true
});

app.plugins.createHexagon({
    container: '.hexagon-dark-16-18',
    width: 16,
    height: 18,
    roundedCorners: true,
    roundedCornerRadius: 1,
    lineColor: '#7750f8',
    fill: true
});

app.plugins.createHexagon({
    container: '.hexagon-120-130',
    width: 120,
    height: 130,
    roundedCorners: true,
    fill: true,
    lineColor: '#1d2333'
});

app.plugins.createHexagon({
    container: '.hexagon-100-108',
    width: 100,
    height: 108,
    roundedCorners: true,
    fill: true,
    lineColor: '#1d2333'
});

app.plugins.createHexagon({
    container: '.hexagon-image-124-136',
    width: 124,
    height: 136,
    roundedCorners: true,
    clip: true
});

app.plugins.createHexagon({
    container: '.hexagon-image-84-92',
    width: 84,
    height: 92,
    roundedCorners: true,
    clip: true
});

app.plugins.createHexagon({
    container: '.hexagon-34-36',
    width: 34,
    height: 36,
    roundedCorners: true,
    roundedCornerRadius: 1,
    fill: true,
    lineColor: '#1d2333'
});

app.plugins.createHexagon({
    container: '.hexagon-image-40-44',
    width: 40,
    height: 44,
    roundedCorners: true,
    roundedCornerRadius: 1,
    clip: true
});

app.plugins.createHexagon({
    container: '.hexagon-image-24-26',
    width: 24,
    height: 26,
    roundedCorners: true,
    roundedCornerRadius: 1,
    clip: true
});

app.plugins.createHexagon({
    container: '.hexagon-image-18-20',
    width: 18,
    height: 20,
    roundedCorners: true,
    roundedCornerRadius: 1,
    clip: true
});

app.plugins.createHexagon({
    container: '.hexagon-overlay-30-32',
    width: 30,
    height: 32,
    roundedCorners: true,
    roundedCornerRadius: 1,
    lineColor: 'rgba(97, 93, 250, .9)',
    fill: true
});


/*-----------------
    FORM INPUT
-----------------*/
app.querySelector('.form-input', function (elements) {
    for (const el of elements) {
        if (el.classList.contains('always-active')) continue;

        const input = el.querySelector('input'),
            textarea = el.querySelector('textarea'),
            activeClass = 'active';

        let inputItem = undefined;

        if (input) inputItem = input;
        if (textarea) inputItem = textarea;

        if (inputItem) {
            inputItem.addEventListener('focus', function () {
                el.classList.add(activeClass);
            });

            inputItem.addEventListener('blur', function () {
                if (inputItem.value === '') {
                    el.classList.remove(activeClass);
                }
            });
        }
    }
});

/*-------------------
    FORM COUNTER
-------------------*/
app.querySelector('.form-counter', function (counters) {
    for (const counter of counters) {
        const value = counter.querySelector('.form-counter-value'),
            increaseButton = counter.querySelector('.form-counter-control-increase'),
            decreaseButton = counter.querySelector('.form-counter-control-decrease'),
            increaseBy = counter.getAttribute('data-increase-by') ? Number.parseInt(counter.getAttribute('data-increase-by'), 10) : 1,
            minValue = counter.getAttribute('data-min') ? Number.parseInt(counter.getAttribute('data-min'), 10) : 1;

        const increaseValue = function () {
            value.innerHTML = Number.parseInt(value.innerHTML, 10) + increaseBy;
        };

        const decreaseValue = function () {
            if (Number.parseInt(value.innerHTML) === minValue) return;
            value.innerHTML = Number.parseInt(value.innerHTML, 10) - increaseBy;
        };

        increaseButton.addEventListener('click', increaseValue);
        decreaseButton.addEventListener('click', decreaseValue);
    }
});

/*-------------------
    FORM SWITCH
-------------------*/
app.querySelector('.form-switch', function (switchInputs) {
    for (const switchInput of switchInputs) {
        const toggleSwitch = function () {
            switchInput.classList.toggle('active');
        };

        switchInput.addEventListener('click', toggleSwitch);
    }
});

/*------------------
    FORM RATING
------------------*/
app.querySelector('.form-rating', function (ratingInputs) {
    for (const ratingInput of ratingInputs) {
        const filledClass = 'filled',
            ratingItems = Array.from(ratingInput.children);

        const getStarsRating = function () {
            let rating = 0;

            for (const ratingItem of ratingItems) {
                if (ratingItem.classList.contains(filledClass)) {
                    rating++;
                }
            }

            return rating;
        };

        const setStarsRating = function () {
            ratingInput.setAttribute('data-rating', getStarsRating());
        };

        const fillStar = function (item) {
            item.classList.add(filledClass);
        };

        const emptyStar = function (item) {
            item.classList.remove(filledClass);
        };

        const toggleStars = function () {
            const itemIndex = ratingItems.indexOf(this);

            for (let i = 0; i <= itemIndex; i++) {
                fillStar(ratingItems[i]);
            }

            for (let i = itemIndex + 1; i < ratingItems.length; i++) {
                emptyStar(ratingItems[i]);
            }

            setStarsRating();
        };

        for (const ratingItem of ratingItems) {
            ratingItem.addEventListener('click', toggleStars);
        }

        setStarsRating();
    }
});

/*------------------------
    INTERACTIVE INPUT
------------------------*/
app.querySelector('.interactive-input', function (elements) {
    for (const el of elements) {
        const input = el.querySelector('input'),
            inputResetIcon = el.querySelector('.interactive-input-action'),
            activeClass = 'active';

        if (input) {
            let previousValue = '';

            const resetInputOnKey = function (e) {
                // ESC key pressed
                if (e.keyCode === 27) {
                    input.value = '';
                    setActiveClass();
                    window.removeEventListener('keydown', resetInputOnKey);
                }
            };

            const setActiveClass = function () {
                if (previousValue === '' && input.value !== '') {
                    el.classList.add(activeClass);
                    window.addEventListener('keydown', resetInputOnKey);
                } else if (input.value === '') {
                    el.classList.remove(activeClass);
                    window.removeEventListener('keydown', resetInputOnKey);
                }
            };

            input.addEventListener('input', setActiveClass);

            if (inputResetIcon) {
                inputResetIcon.addEventListener('click', function () {
                    input.value = '';
                    input.focus();
                    setActiveClass();
                });
            }
        }
    }
});

/*-------------------
    CONTENT GRID
-------------------*/
app.querySelector('.content-grid', function (el) {
    const sidebar = {
        chat: {
            active: false,
            minWidth: 80,
            maxWidth: 300
        },
        navigation: {
            active: false,
            minWidth: 80,
            maxWidth: 300
        }
    },
        breakpointWidth = 1366;

    const updateGridPosition = function (contentGrid) {
        if (window.innerWidth > breakpointWidth) {
            const chatWidth = sidebar.chat.active ? sidebar.chat.maxWidth : sidebar.chat.minWidth,
                navigationWidth = sidebar.navigation.active ? sidebar.navigation.maxWidth : sidebar.navigation.minWidth,
                availableWidth = document.body.clientWidth - contentGrid.offsetWidth - chatWidth - navigationWidth,
                offsetX = (availableWidth / 2) + navigationWidth;

            contentGrid.style.transform = `translate(${offsetX}px, 0)`;
        } else {
            contentGrid.style.transform = `translate(0, 0)`;
        }
    };

    const updateGridPositions = function () {
        for (const grid of el) {
            updateGridPosition(grid);
        }
    };

    const setGridTransition = function (grid) {
        grid.style.transition = `transform .4s ease-in-out`;
    };

    const setGridTransitions = function () {
        for (const grid of el) {
            setGridTransition(grid);
        }
    };

    updateGridPositions();
    window.addEventListener('resize', updateGridPositions);
    // delay transition setup to avoid loading animation
    window.setTimeout(setGridTransitions, 300);

    /*-------------------
        CHAT WIDGET
    -------------------*/
    app.querySelector('#chat-widget-messages', function (el) {
        const chatWidget = el[0],
            topOffset = 80,
            closedWidth = 80,
            openWidth = 300,
            chatWidgetMessages = chatWidget.querySelector('.chat-widget-messages'),
            chatWidgetForm = chatWidget.querySelector('.chat-widget-form'),
            chatWidgetButton = chatWidget.querySelector('.chat-widget-button'),
            closedClass = 'closed';

        const setChatMessagesDimensions = function () {
            if (chatWidget.classList.contains(closedClass)) {
                chatWidgetMessages.style.height = `${window.innerHeight - chatWidgetButton.offsetHeight - topOffset}px`;
            } else {
                chatWidgetMessages.style.height = `${window.innerHeight - chatWidgetForm.offsetHeight - chatWidgetButton.offsetHeight - topOffset}px`;
            }
        };

        const toggleChatWidget = function () {
            chatWidget.classList.toggle(closedClass);
            setChatMessagesDimensions();

            sidebar.chat.active = !chatWidget.classList.contains(closedClass);
            updateGridPositions();
        };

        const openChatWidget = function () {
            chatWidget.classList.remove(closedClass);
            setChatMessagesDimensions();

            sidebar.chat.active = true;
            updateGridPositions();
        };

        chatWidgetButton.addEventListener('click', toggleChatWidget);

        setChatMessagesDimensions();
        window.addEventListener('resize', setChatMessagesDimensions);

        app.querySelector('#chat-widget-message', function (el) {
            const chatMessageWidget = el[0],
                chatWidgetMessage = chatWidgetMessages.querySelectorAll('.chat-widget-message'),
                chatMessageWidgetHeader = chatMessageWidget.querySelector('.chat-widget-header'),
                chatMessageWidgetConversation = chatMessageWidget.querySelector('.chat-widget-conversation'),
                chatMessageWidgetCloseButton = chatMessageWidget.querySelector('.chat-widget-close-button'),
                hiddenClass = 'hidden';

            const setChatConversationDimensions = function () {
                chatMessageWidgetConversation.style.height = `${window.innerHeight - chatMessageWidgetHeader.offsetHeight - chatWidgetForm.offsetHeight - chatWidgetButton.offsetHeight - topOffset}px`;
            };

            const toggleChatMessageWidget = function () {
                chatMessageWidget.classList.toggle(hiddenClass);
            };

            const closeChatMessageWidget = function () {
                chatMessageWidget.classList.add(hiddenClass);
            };

            for (const widgetMessage of chatWidgetMessage) {
                widgetMessage.addEventListener('click', toggleChatMessageWidget);
                widgetMessage.addEventListener('click', openChatWidget);
            }

            chatWidgetButton.addEventListener('click', closeChatMessageWidget);
            chatMessageWidgetCloseButton.addEventListener('click', toggleChatMessageWidget);

            setChatConversationDimensions();
            window.addEventListener('resize', setChatConversationDimensions);
        });
    });

    /*------------------------
        NAVIGATION WIDGET
    ------------------------*/
    app.querySelector('.navigation-widget-trigger', function (el) {
        const navigationTrigger = el[0],
            topOffset = 80,
            navigationWidget = document.querySelector('#navigation-widget'),
            navigationWidgetSmall = document.querySelector('#navigation-widget-small'),
            activeClass = 'active',
            hiddenClass = 'hidden',
            delayedClass = 'delayed';

        const setNavigationWidgetDimensions = function () {
            navigationWidget.style.height = `${window.innerHeight - topOffset}px`;
        };

        const toggleNavigationWidget = function () {
            navigationTrigger.classList.toggle(activeClass);

            navigationWidget.classList.toggle(delayedClass);
            navigationWidget.classList.toggle(hiddenClass);
            navigationWidgetSmall.classList.toggle(delayedClass);
            navigationWidgetSmall.classList.toggle(hiddenClass);

            sidebar.navigation.active = !navigationWidget.classList.contains(hiddenClass);
            updateGridPositions();
        };

        navigationTrigger.addEventListener('click', toggleNavigationWidget);

        setNavigationWidgetDimensions();
        window.addEventListener('resize', setNavigationWidgetDimensions);
    });

    /*-------------------------------
        NAVIGATION WIDGET MOBILE
    -------------------------------*/
    app.querySelector('.navigation-widget-mobile-trigger', function (el) {
        const navigationMobileTrigger = el[0],
            navigationWidgetMobile = document.querySelector('#navigation-widget-mobile'),
            navigationWidgetMobileCloseButton = navigationWidgetMobile.querySelector('.navigation-widget-close-button'),
            hiddenClass = 'hidden';

        const overlay = document.createElement('div');

        overlay.style.width = '100%';
        overlay.style.height = '100%';
        overlay.style.position = 'fixed';
        overlay.style.top = '0';
        overlay.style.left = '0';
        overlay.style.zIndex = 99998;
        overlay.style.backgroundColor = 'rgba(21, 21, 31, .96)';
        overlay.style.opacity = 0;
        overlay.style.visibility = 'hidden';
        overlay.style.transition = 'opacity .3s ease-in-out, visibility .3s ease-in-out';

        document.body.appendChild(overlay);

        const showOverlay = function () {
            overlay.style.opacity = 1;
            overlay.style.visibility = 'visible';
        };

        const hideOverlay = function () {
            overlay.style.opacity = 0;
            overlay.style.visibility = 'hidden';
        };

        const setNavigationWidgetMobileDimensions = function () {
            navigationWidgetMobile.style.height = `${window.innerHeight}px`;
        };

        const toggleNavigationWidgetMobile = function () {
            navigationWidgetMobile.classList.toggle(hiddenClass);

            const toggleOverlay = navigationWidgetMobile.classList.contains(hiddenClass) ? hideOverlay : showOverlay;
            toggleOverlay();
        };

        navigationMobileTrigger.addEventListener('click', toggleNavigationWidgetMobile);
        navigationWidgetMobileCloseButton.addEventListener('click', toggleNavigationWidgetMobile);
        overlay.addEventListener('click', toggleNavigationWidgetMobile);

        setNavigationWidgetMobileDimensions();
        window.addEventListener('resize', setNavigationWidgetMobileDimensions);
    });
});

/*--------------------
    HEADER SEARCH
--------------------*/
app.querySelector('#search-main', function (el) {
    const headerSearchDropdown = app.plugins.createDropdown({
        container: '.header-search-dropdown',
        offset: {
            top: 57,
            left: 0
        },
        animation: {
            type: 'translate-top'
        },
        controlToggle: true,
        closeOnWindowClick: false
    });

    const searchInput = el[0],
        breakpointWidth = 960;

    let previousValue = '';

    const hideSearchDropdownOnKey = function (e) {
        // ESC key pressed
        if (e.keyCode === 27) {
            headerSearchDropdown.hideDropdowns();
            previousValue = '';
            window.removeEventListener('keydown', hideSearchDropdownOnKey);
        }
    };

    const toggleSearchDropdown = function (e) {
        if (previousValue === '' && e.target.value !== '') {
            headerSearchDropdown.showDropdowns();
            window.addEventListener('keydown', hideSearchDropdownOnKey);
        } else if (e.target.value === '') {
            headerSearchDropdown.hideDropdowns();
            window.removeEventListener('keydown', hideSearchDropdownOnKey);
        }
        previousValue = e.target.value;
    };

    const interactiveInputAction = searchInput.parentElement.querySelector('.interactive-input-action');

    const hideSearchDropdown = function () {
        headerSearchDropdown.hideDropdowns();
        window.removeEventListener('keydown', hideSearchDropdownOnKey);
        previousValue = '';
    };

    if (window.innerWidth > breakpointWidth) {
        searchInput.addEventListener('input', toggleSearchDropdown);
        interactiveInputAction.addEventListener('click', hideSearchDropdown);
    }
});

/*----------------------
    HEADER DROPDOWNS
----------------------*/
app.plugins.createDropdown({
    trigger: '.header-dropdown-trigger',
    container: '.header-dropdown',
    offset: {
        top: 64,
        right: 6
    },
    animation: {
        type: 'translate-top'
    }
});

app.plugins.createDropdown({
    trigger: '.header-settings-dropdown-trigger',
    container: '.header-settings-dropdown',
    offset: {
        top: 64,
        right: 22
    },
    animation: {
        type: 'translate-top'
    }
});

/*---------------------------
    HEADER PROGRESS BARS
---------------------------*/
app.plugins.createProgressBar({
    container: '#logged-user-level',
    height: 4,
    lineColor: '#5538b5'
});

app.plugins.createProgressBar({
    container: '#logged-user-level',
    height: 4,
    gradient: {
        colors: ['#40d04f', '#d9ff65']
    },
    scale: {
        start: 0,
        end: 100,
        stop: 62
    },
    linkText: true,
    linkUnits: 'exp',
    invertedProgress: true
});

app.plugins.createProgressBar({
    container: '#logged-user-level-cp',
    height: 4,
    lineColor: '#5538b5'
});

app.plugins.createProgressBar({
    container: '#logged-user-level-cp',
    height: 4,
    gradient: {
        colors: ['#40d04f', '#d9ff65']
    },
    scale: {
        start: 0,
        end: 100,
        stop: 62
    },
    linkText: true,
    linkUnits: 'exp',
    invertedProgress: true
});

app.querySelector('.liquid', function (images) {
    for (const image of images) {
        app.liquidify(image);
    }
});

app.querySelector('.page-loader', function (el) {
    const pageLoader = el[0];

    const hidePageLoader = function () {
        pageLoader.classList.add('hidden');
    };

    window.addEventListener('load', hidePageLoader);
});
